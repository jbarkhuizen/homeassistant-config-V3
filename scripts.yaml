# OneDrive Management Scripts (Updated)
# Add these to your scripts.yaml file

# Diagnostic script to check all OneDrive entities
onedrive_diagnostic_check:
  alias: "OneDrive Diagnostic Check"
  description: "Check status of all OneDrive entities for troubleshooting"
  sequence:
    - service: notify.mobile_app_your_phone  # Replace with your actual device name
      data:
        title: "ğŸ” OneDrive Diagnostic Report"
        message: >
          CORE ENTITIES STATUS:
          â€¢ Used Storage: {{ states('sensor.onedrive_used_storage') }}
          â€¢ Total Storage: {{ states('sensor.onedrive_total_available_storage') }}
          â€¢ Remaining: {{ states('sensor.onedrive_remaining_storage') }}
          â€¢ Percentage: {{ states('sensor.onedrive_storage_percentage') }}%
          â€¢ Drive State: {{ states('sensor.onedrive_drive_state') }}
          â€¢ Health: {{ states('binary_sensor.onedrive_health') }}
          â€¢ Storage Warning: {{ states('binary_sensor.onedrive_storage_warning') }}
          â€¢ Days Until Full: {{ states('sensor.onedrive_days_until_full') }}
        data:
          tag: "onedrive_diagnostic"

# Create Home Assistant Backup to OneDrive (Updated)
create_onedrive_backup:
  alias: "Create OneDrive Backup"
  description: "Create a full Home Assistant backup and sync to OneDrive"
  sequence:
    - service: notify.mobile_app_your_phone  # Replace with your actual device name
      data:
        title: "ğŸ”„ Backup Starting"
        message: "Creating Home Assistant backup..."
    - service: backup.create
      data:
        name: "HA_Backup_{{ now().strftime('%Y%m%d_%H%M%S') }}"
        compressed: true
    - delay:
        minutes: 5  # Wait for backup to complete
    - service: notify.mobile_app_your_phone  # Replace with your actual device name
      data:
        title: "âœ… Backup Complete"
        message: >
          Home Assistant backup created successfully!
          Current OneDrive usage: {{ states('sensor.onedrive_storage_percentage') }}%
        data:
          tag: "backup_complete"

# Force OneDrive Sync (Updated)
force_onedrive_sync:
  alias: "Force OneDrive Sync"
  description: "Manually trigger OneDrive synchronization"
  sequence:
    - service: notify.mobile_app_your_phone  # Replace with your actual device name
      data:
        title: "ğŸ”„ Force Sync Started"
        message: >
          Forcing OneDrive sync...
          Current state: {{ states('sensor.onedrive_drive_state') }}
    # Note: The actual sync command depends on your OneDrive integration
    # You may need to call a specific service here
    - delay:
        minutes: 2
    - service: notify.mobile_app_your_phone  # Replace with your actual device name
      data:
        title: "âœ… Sync Process Complete"
        message: >
          OneDrive sync process completed.
          Drive state: {{ states('sensor.onedrive_drive_state') }}
          Health: {{ states('binary_sensor.onedrive_health') }}

# OneDrive Health Check (Updated with actual entities)
onedrive_health_check:
  alias: "OneDrive Health Check"
  description: "Perform comprehensive OneDrive health check"
  sequence:
    - service: notify.mobile_app_your_phone  # Replace with your actual device name
      data:
        title: "ğŸ” Health Check Running"
        message: "Performing OneDrive health check..."
    - delay:
        seconds: 10
    - service: notify.mobile_app_your_phone  # Replace with your actual device name
      data:
        title: "ğŸ“Š OneDrive Health Report"
        message: >
          HEALTH CHECK RESULTS:
          
          ğŸ”— Connection: {{ 'Good' if is_state('binary_sensor.onedrive_health', 'on') else 'Issues Detected' }}
          ğŸ“Š Drive State: {{ states('sensor.onedrive_drive_state') | title }}
          ğŸ’¾ Storage: {{ states('sensor.onedrive_storage_percentage') }}% used
          âš ï¸ Storage Warning: {{ 'Active' if is_state('binary_sensor.onedrive_storage_warning', 'on') else 'None' }}
          ğŸ“ˆ Used Space: {{ states('sensor.onedrive_used_storage') }}GB
          ğŸ“‰ Remaining: {{ states('sensor.onedrive_remaining_storage') }}GB
          ğŸ—“ï¸ Days Until Full: {{ states('sensor.onedrive_days_until_full') }}
        data:
          actions:
            - action: "VIEW_DASHBOARD"
              title: "View Dashboard"
            - action: "FORCE_SYNC"
              title: "Force Sync"

# Add these scripts to your scripts.yaml file

# Immediate Telegram Test
test_telegram_now:
  alias: "Test Telegram Right Now"
  sequence:
    - service: notify.telegram
      data:
        title: "ğŸ”§ Telegram Test"
        message: |
          Telegram test at {{ now().strftime('%H:%M:%S') }}
          
          If you receive this message, your Telegram bot is working! âœ…
          
          System: Home Assistant (192.168.1.30:8123)
          Status: All systems operational

# Telegram System Status
telegram_system_status:
  alias: "Telegram System Status"
  sequence:
    - service: notify.telegram
      data:
        title: "ğŸ“Š System Status"
        message: |
          ğŸ  Home Assistant Status Report
          Time: {{ now().strftime('%Y-%m-%d %H:%M:%S') }}
          
          ğŸ–¥ï¸ SERVER STATUS:
          â€¢ Status: {{ states('sensor.johanba_server_status') | title }}
          â€¢ Temperature: {{ states('sensor.johanba_server_system_temperature') }}Â°C
          â€¢ CPU Usage: {{ states('sensor.johanba_server_cpu_usage') }}%
          â€¢ Memory: {{ states('sensor.johanba_server_memory_usage') }}%
          
          â˜ï¸ ONEDRIVE:
          â€¢ Used: {{ states('sensor.onedrive_used_storage') }}GB
          â€¢ Free: {{ states('sensor.onedrive_remaining_storage') }}GB
          â€¢ Status: {{ states('sensor.onedrive_drive_state') | title }}
          
          ğŸŒ NETWORK:
          â€¢ WAN: {{ 'Connected âœ…' if is_state('binary_sensor.archer_d2_wan_status', 'on') else 'Disconnected âŒ' }}
          â€¢ IP: {{ states('sensor.archer_d2_external_ip') }}
          
          All systems monitored! ğŸ¯

# Telegram with photo (if you want to test media)
telegram_test_with_photo:
  alias: "Telegram Test with System Info"
  sequence:
    - service: notify.telegram
      data:
        title: "ğŸ“± Advanced Telegram Test"
        message: |
          ğŸ  Home Assistant Advanced Test
          
          This message tests formatting:
          
          *Bold Text*
          _Italic Text_
          `Code Text`
          
          ğŸ”¹ Bullet points work
          ğŸ”¹ Emojis work âœ…
          ğŸ”¹ Multiple lines work
          
          System IP: {{ states('sensor.archer_d2_external_ip') }}
          Time: {{ now().strftime('%H:%M:%S') }}
          
          If you can read this formatted message, everything is perfect! ğŸ‰              