# OneDrive Management Scripts (Updated)
# Add these to your scripts.yaml file

# Diagnostic script to check all OneDrive entities
onedrive_diagnostic_check:
  alias: "OneDrive Diagnostic Check"
  description: "Check status of all OneDrive entities for troubleshooting"
  sequence:
    - service: notify.mobile_app_your_phone  # Replace with your actual device name
      data:
        title: "ğŸ” OneDrive Diagnostic Report"
        message: >
          CORE ENTITIES STATUS:
          â€¢ Used Storage: {{ states('sensor.onedrive_used_storage') }}
          â€¢ Total Storage: {{ states('sensor.onedrive_total_available_storage') }}
          â€¢ Remaining: {{ states('sensor.onedrive_remaining_storage') }}
          â€¢ Percentage: {{ states('sensor.onedrive_storage_percentage') }}%
          â€¢ Drive State: {{ states('sensor.onedrive_drive_state') }}
          â€¢ Health: {{ states('binary_sensor.onedrive_health') }}
          â€¢ Storage Warning: {{ states('binary_sensor.onedrive_storage_warning') }}
          â€¢ Days Until Full: {{ states('sensor.onedrive_days_until_full') }}
        data:
          tag: "onedrive_diagnostic"

# Create Home Assistant Backup to OneDrive (Updated)
create_onedrive_backup:
  alias: "Create OneDrive Backup"
  description: "Create a full Home Assistant backup and sync to OneDrive"
  sequence:
    - service: notify.mobile_app_your_phone  # Replace with your actual device name
      data:
        title: "ğŸ”„ Backup Starting"
        message: "Creating Home Assistant backup..."
    - service: backup.create
      data:
        name: "HA_Backup_{{ now().strftime('%Y%m%d_%H%M%S') }}"
        compressed: true
    - delay:
        minutes: 5  # Wait for backup to complete
    - service: notify.mobile_app_your_phone  # Replace with your actual device name
      data:
        title: "âœ… Backup Complete"
        message: >
          Home Assistant backup created successfully!
          Current OneDrive usage: {{ states('sensor.onedrive_storage_percentage') }}%
        data:
          tag: "backup_complete"

# Force OneDrive Sync (Updated)
force_onedrive_sync:
  alias: "Force OneDrive Sync"
  description: "Manually trigger OneDrive synchronization"
  sequence:
    - service: notify.mobile_app_your_phone  # Replace with your actual device name
      data:
        title: "ğŸ”„ Force Sync Started"
        message: >
          Forcing OneDrive sync...
          Current state: {{ states('sensor.onedrive_drive_state') }}
    # Note: The actual sync command depends on your OneDrive integration
    # You may need to call a specific service here
    - delay:
        minutes: 2
    - service: notify.mobile_app_your_phone  # Replace with your actual device name
      data:
        title: "âœ… Sync Process Complete"
        message: >
          OneDrive sync process completed.
          Drive state: {{ states('sensor.onedrive_drive_state') }}
          Health: {{ states('binary_sensor.onedrive_health') }}

# OneDrive Health Check (Updated with actual entities)
onedrive_health_check:
  alias: "OneDrive Health Check"
  description: "Perform comprehensive OneDrive health check"
  sequence:
    - service: notify.mobile_app_your_phone  # Replace with your actual device name
      data:
        title: "ğŸ” Health Check Running"
        message: "Performing OneDrive health check..."
    - delay:
        seconds: 10
    - service: notify.mobile_app_your_phone  # Replace with your actual device name
      data:
        title: "ğŸ“Š OneDrive Health Report"
        message: >
          HEALTH CHECK RESULTS:
          
          ğŸ”— Connection: {{ 'Good' if is_state('binary_sensor.onedrive_health', 'on') else 'Issues Detected' }}
          ğŸ“Š Drive State: {{ states('sensor.onedrive_drive_state') | title }}
          ğŸ’¾ Storage: {{ states('sensor.onedrive_storage_percentage') }}% used
          âš ï¸ Storage Warning: {{ 'Active' if is_state('binary_sensor.onedrive_storage_warning', 'on') else 'None' }}
          ğŸ“ˆ Used Space: {{ states('sensor.onedrive_used_storage') }}GB
          ğŸ“‰ Remaining: {{ states('sensor.onedrive_remaining_storage') }}GB
          ğŸ—“ï¸ Days Until Full: {{ states('sensor.onedrive_days_until_full') }}
        data:
          actions:
            - action: "VIEW_DASHBOARD"
              title: "View Dashboard"
            - action: "FORCE_SYNC"
              title: "Force Sync"